#!/bin/sh

echo "Running hook"

exit_if_fail () {
  local result=$?
  if [ $result -ne 0 ]; then
    echo exit code = $result
    exit $result
  fi
}

# Web app checks
WEB_APP_PATH="ctrlSrv/app/"
if git diff --cached --name-only | grep --quiet "$WEB_APP_PATH"
then
  cd $WEB_APP_PATH
  echo "Formating..."
	npm run format
  exit_if_fail
  echo "Checking code..."
	npm run check
  exit_if_fail
  npm run lint
  exit_if_fail
  echo "Adding autogenerated updates..."
  git add .
  cd ../../
  exit 0
fi

# Rest checks
REST_PATH="ctrlSrv/rest/"
if git diff --cached --name-only | grep --quiet "$REST_PATH"
then
  cd $REST_PATH
  echo "Checking code..."
	npm run lint:fix
  echo "Adding autogenerated updates..."
  git add .
  cd ../../
  exit 0
fi